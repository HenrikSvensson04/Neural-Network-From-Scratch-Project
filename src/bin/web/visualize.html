<!DOCTYPE html>
<html>
  <head>


    <meta charset="utf-8" />

    <title>My Wasm Project</title>
    <link rel="stylesheet" href="style.css" />
    <script src="https://d3js.org/d3.v7.min.js"></script>

  </head>


  <body>
    <div class = "top">
      <section class = "top-section">
        <p>
          Visualizer for simple neural network!
        </p>
      </section>
    </div>

    
    <div class = "visualize">

      <div class = "visualisation-right-right">
      </div>

      <div class = "visualisation-right-mid">

    
        </section class = "control-1">
          <button class = "button"> Train network! </button>
        </section>

        </section class = "control-2">
          <p style = "font: 1.2rem Fira Sans, sans-serif;">
            Activation function:
          </p>

            <div class="custom-select">
              <select>
                <option value="0">Sigmoid</option>
              </select>
            </div>
        </section>

        </section class = "control-3">
        <p style = "font: 1.2rem Fira Sans, sans-serif;">
          Dataset:
        </p>
        <div class="custom-select">
          <select>
            <option value="0">Simple</option>
            <option value="1">Complex</option>
            <option value="2">Spiral</option>
          </select>
        </div>
        </section>

        </section class = "control-4">
        <p style = "font: 1.2rem Fira Sans, sans-serif;">
          Learning rate
        </p>
        <div class="custom-select">
          <select>
            <option value="0">1.0</option>
          </select>
        </div>
        </section>


      </div>

      <div class = "visualisation-left-mid">

        <section class = "v" id = "vis">
          
        </section>
        
      </div>
      <section class = "visualisation-left-left">

        
      </div>
    </div>

    <div class = "bottom", id = "b">

      <section>
        <svg id="data_area" height=200 width=450></svg>

        <script>

          
          var margin = {top: 20, right:10, bottom: 30, left: 50}
          var height = 200
          var width = 450

          var svg = d3.select("#data_area")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
          /*
          var x = d3.scaleLinear()
                  .domain([0.0, 1.0])
                  .range([0, width])

          svg.append("g")
          .attr("transform", "translate(0, " + height+ ")").call(d3.axisBottom(x));


          var y = d3.scaleLinear()
                  .domain([0.0, 1.0])
                  .range([height, 0])
          */
          svg.append("g").call(d3.axisLeft(y));

          var data = [ {x:0.10, y:0.20}, {x:0.40, y:0.90}, {x:0.80, y:0.50} ]
          
          // Add 3 dots for 0, 50 and 100%
          /*
          svg
              .selectAll("whatever")
              .data(data)
              .enter()
              .append("circle")
                .attr("cx", function(d){ return x(d.x) })
                .attr("cy", function(d){ return y(d.y) })
                .attr("r", 7)

          */


        </script>
      </section>
    
    </div>



  <script>

    var margin = {top: 20, right:10, bottom: 30, left: 50}
    var width = 400;
    var height = 400; 

    var svg = d3.select("#vis")//.append("svg").attr("width", width).attr("height", height)
    //var svg = d3.select("#data_area")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
              .append("g")
              .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

              
    
    
    // Retrived from: https://wizardace.com/d3-heatmap/
    var n = 100;
    var matrix = new Array(n);
    for(var i = 0; i < n; i++) {
      matrix[i] = new Array(n);
      for(var j = 0; j < n; j++) {
        matrix[i][j] = Math.random();
      }
    }
  
    // Retrived from: https://wizardace.com/d3-heatmap/
    var svg = d3.select("#vis").append("svg").attr("width", width).attr("height", height);
    g = svg.append("g").attr("transform", "translate(" + 0 + "," + 0 + ")");
  
    // Retrived from: https://wizardace.com/d3-heatmap/
    var scale = d3.scaleBand().rangeRound([0, d3.min([width, height])]).domain(d3.range(n));
  
    var color = d3.scaleSequential(
        function(t) { return d3.interpolate("white", "steelblue")(t); }
      )
      .domain([0, d3.max(matrix, function(row) { return d3.max(row) })]);
  
    // Retrived from: https://wizardace.com/d3-heatmap/
    g.selectAll(".row")
      .data(matrix)
      .enter()
      .append("g")
      .attr("class", "row")
      .attr("transform", function(d, i) { return "translate(0," + scale(i) + ")"; })
      .selectAll(".cell")
      .data(function(d) { return d })
      .enter()
      .append("rect")
      .attr("class", "cell")
      .attr("x", function(d, i) { return scale(i); })
      .attr("width", scale.bandwidth())
      .attr("height", scale.bandwidth())
      .attr("opacity", 0.7)
      .attr("fill", function(d) {return d3.rgb(d * 256 * Math.random(), 0, 0); });


      // set x-axis scale
      var x = d3.scaleLinear()
              .domain([0.0, 1.0])
              .range([0, width])

      svg.append("g")
      .attr("transform", "translate(0, " + height + ")").call(d3.axisBottom(x));

      var y = d3.scaleLinear()
              .domain([0.0, 1.0])
              .range([height, 0])

      svg.append("g").call(d3.axisLeft(y));
      var data = [ {x:0.10, y:0.20}, {x:0.40, y:0.90}, {x:0.80, y:0.50}, {x:0.85, y:0.54}, {x:0.78, y:0.49}, {x:0.83, y:0.46}, {x:0.9, y:0.9}]

      // Add 3 dots for 0, 50 and 100%
      svg
      .selectAll("whatever")
      .data(data)
      .enter()
      .append("circle")
      .attr("cx", function(d){ return x(d.x) })
      .attr("cy", function(d){ return y(d.y) })
      .attr("r", 5)
      .attr("fill", function(d) {return d3.rgb(256, 0, 0); })
      .style("stroke", "black")    // set the line colour
      
      //.attr("fill", function(d,j) {return d3.rgb(matrix[d][j].r * 256, matrix[d][j].g * 256, matrix[d][j].b * 256); });
    </script>
    <script type="module">


      // Importing WASM as a JS module requires us to call an init function provided by the default export.
      // This is planned to be changed in the future.
      //import { default as wasm, NeuralWrapper, insert_traning_data, get_something} from "/pkg/simple_neural_network_project.js";
      import { default as wasm, NeuralWrapper, echo} from "/pkg/simple_neural_network_project.js";

      wasm().then((module) => {
        // The boiler plate project comes with a `greet` function that calls:
        alert("Hello, hello-wasm!");

        var neural_network_wrapper = new NeuralWrapper(100);
        //var v = neural_network_wrapper.echo(100);
        //alert(v.toString());

        //alert(neural_network_wrapper.get_something().toString())
        neural_network_wrapper.insert_traning_data([0.2, 0.9], [0.0, 1.0])

        alert(neural_network_wrapper.get().toString());

        /*
        // fetch initial dataset
        fetch("/dataset_1.csv")
            .then(reponse => response.json())
            .then(json => {
                json.array.forEach(element => {
                    
                });
            });
        */

        //greet();
        //console.log(greet("Hi henrik"));
      });
    </script>
  </body>
</html>